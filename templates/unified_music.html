{% extends "base.html" %}
{% block title %}éŸ³æºãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ - ã‚³ã‚¨ã‚«ãƒ«ãƒ†{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto;">
  <h2>ğŸ§ éŸ³æºãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h2>
  <p>ç„¡æ–™ãƒ»æœ‰æ–™éŸ³æºã‚’ã“ã¡ã‚‰ã‹ã‚‰ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚</p>

  <h3>ğŸ”“ ç„¡æ–™éŸ³æº</h3>
  <ul>
    <li><p>ãƒã‚¸ãƒ†ã‚£ãƒ–</p>
      <audio controls><source src="{{ url_for('static', filename='free/free-positive.mp3') }}"></audio></li>
    <li><p>ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹</p>
      <audio controls><source src="{{ url_for('static', filename='free/free-mindfulness.mp3') }}"></audio></li>
    <li><p>ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³</p>
      <audio controls><source src="{{ url_for('static', filename='free/free-relaxation.mp3') }}"></audio></li>
  </ul>

  <h3 style="margin-top: 40px;">ğŸŸ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ éŸ³æº</h3>

  {% if can_play_premium %}
    <p style="color: green;">âœ… ç„¡æ–™æœŸé–“ä¸­ / æœ‰æ–™ãƒ—ãƒ©ãƒ³ã®ãŸã‚ã€ã™ã¹ã¦ã®éŸ³æºã‚’å†ç”Ÿã§ãã¾ã™ã€‚</p>
    {% set categories = {'ãƒã‚¸ãƒ†ã‚£ãƒ–': [], 'ãƒªãƒ©ãƒƒã‚¯ã‚¹': [], 'ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹': []} %}
    {% for track in tracks %}
      {% if 'positive' in track.filename %}
        {% set _ = categories['ãƒã‚¸ãƒ†ã‚£ãƒ–'].append(track) %}
      {% elif 'relax' in track.filename %}
        {% set _ = categories['ãƒªãƒ©ãƒƒã‚¯ã‚¹'].append(track) %}
      {% elif 'mindfulness' in track.filename %}
        {% set _ = categories['ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹'].append(track) %}
      {% endif %}
    {% endfor %}

    {% for label, group in categories.items() %}
      <h4 class="toggle-header">ğŸ¶ {{ label }}ç³»</h4>
      <div class="toggle-content">
        <ul style="list-style: none; padding: 0;">
          {% for track in group %}
          <li style="margin-bottom: 20px;">
            <p>{{ track.display }}</p>
            <audio controls style="width: 100%;">
              <source src="{{ url_for('static', filename='paid/' + track.filename) }}" type="audio/mpeg">
            </audio>
          </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  {% else %}
    <p style="color: #a00;">
      âš ï¸ ç„¡æ–™æœŸé–“ã¯çµ‚äº†ã—ã¾ã—ãŸã€‚<br>
      ãƒ—ãƒ¬ãƒŸã‚¢ãƒ éŸ³æºã‚’ã”åˆ©ç”¨ã„ãŸã ãã«ã¯ã€æœ‰æ–™ãƒ—ãƒ©ãƒ³ã¸ã®ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚
    </p>
    <a href="{{ url_for('checkout') }}" class="btn btn-warning">ğŸŸ ä»Šã™ãç™»éŒ²ã™ã‚‹</a>
  {% endif %}

  <a href="/dashboard" class="auth-links">ğŸ  ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.toggle-header').forEach(header => {
    header.addEventListener('click', () => {
      const next = header.nextElementSibling;
      next.style.display = next.style.display === 'none' ? 'block' : 'none';
    });
  });
});
</script>

<style>
.toggle-header {
  cursor: pointer;
  background-color: #f5f5f5;
  padding: 8px;
  border-radius: 5px;
  margin-top: 15px;
}
.toggle-content {
  display: none;
}
</style>
{% endblock %}
